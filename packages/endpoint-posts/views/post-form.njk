{% extends "form.njk" %}

{% set contentOptional =
  postType !== "article" and
  postType !== "note" and
  postType !== "reply" %}
{% set contentIgnored =
  postType === "like"
%}
{% set nameOptional =
  postType !== "article" and
  postType !== "bookmark" %}
{% set nameIgnored =
  postType === "note" or
  postType === "like" or
  postType === "reply" or
  postType === "rsvp"
%}

{% block fieldset %}
  {{ input({
    name: "type",
    value: "event" if postType === "event" else "entry",
    type: "hidden"
  }) | indent(2) }}

  {{ input({
    name: "post-type",
    value: postType,
    type: "hidden"
  }) | indent(2) }}

  {{ input({
    id: "bookmark-of",
    name: "bookmark-of",
    value: errors["bookmark-of"].value or post["bookmark-of"],
    label: {
      text: __("posts.form.bookmark-of.label")
    },
    errorMessage: {
      text: errors["bookmark-of"].msg
    } if errors["bookmark-of"]
  }) | indent(2) if postType === "bookmark" }}

  {{ input({
    id: "in-reply-to",
    name: "in-reply-to",
    value: errors["in-reply-to"].value or post["in-reply-to"],
    label: {
      text: __("posts.form.in-reply-to.label")
    },
    errorMessage: {
      text: errors["in-reply-to"].msg
    } if errors["in-reply-to"]
  }) | indent(2) if postType === "reply" or postType === "rsvp" }}

  {{ radios({
    classes: "radios--inline",
    idPrefix: "rsvp",
    name: "rsvp",
    fieldset: {
      legend: {
        text: __("posts.form.rsvp.label")
      }
    },
    items: rsvpItems
  }) | indent(2) if postType === "rsvp" }}

  {{ input({
    id: "like-of",
    name: "like-of",
    value: errors["like-of"].value or post["like-of"],
    label: {
      text: __("posts.form.like-of.label")
    },
    errorMessage: {
      text: errors["like-of"].msg
    } if errors["like-of"]
  }) | indent(2) if postType === "like" }}

  {{ input({
    id: "repost-of",
    name: "repost-of",
    value: errors["repost-of"].value or post["repost-of"],
    label: {
      text: __("posts.form.repost-of.label")
    },
    errorMessage: {
      text: errors["repost-of"].msg
    } if errors["repost-of"]
  }) | indent(2) if postType === "repost" }}

  {{ input({
    id: "name",
    name: "name",
    value: errors.name.value or post.name,
    label: {
      text: __("posts.form.name.label")
    },
    optional: nameOptional,
    errorMessage: {
      text: errors.name.msg
    } if errors.name
  }) | indent(2) if not nameIgnored }}

  {{ textarea({
    id: "content",
    name: "content",
    value: errors.content.value or post.content.text,
    label: {
      text: __("posts.form.content.label")
    },
    optional: contentOptional,
    errorMessage: {
      text: errors.content.msg
    } if errors.content
  }) | indent(2) if not contentIgnored }}

  {{ checkboxes({
    idPrefix: "mp-syndicate-to",
    name: "mp-syndicate-to",
    fieldset: {
      legend: {
        text: __("posts.form.mp-syndicate-to.label")
      }
    },
    items: syndicationTargetItems
  }) | indent(2) }}

  {% call details({ summary: __("posts.form.advancedOptions") }) %}
    {{ input({
      value: errors.category.value or post.category,
      label: {
        text: __("posts.form.category.label")
      },
      optional: true,
      attributes: {
        "data-controller": "token-input",
        "data-token-input-items-value": publication.categories
      }
    }) | indent(4) }}

    {{ input({
      id: "mp-slug",
      name: "mp-slug",
      value: errors["mp-slug"].value or post["mp-slug"],
      label: {
        text: __("posts.form.mp-slug.label")
      },
      optional: true
    }) | indent(4) }}

    {{ radios({
      classes: "radios--inline",
      idPrefix: "visibility",
      name: "visibility",
      fieldset: {
        legend: {
          text: __("posts.form.visibility.label")
        }
      },
      items: visibilityItems
    }) | indent(4) }}
  {% endcall %}

  <div class="button-group">
    {{ button({
      name: "post-status",
      value: "published",
      text: __("posts.form.update") if postStatus === "published" else __("posts.form.publish")
    }) | indent(4) if not draftMode }}

    {{ button({
      name: "post-status",
      value: "draft",
      classes: "button--secondary",
      text: __("posts.form.updateDraft") if postStatus === "draft" else __("posts.form.publishDraft")
    }) | indent(4) if postStatus !== "published" }}

    {{ prose({
      text: "[" + __("posts.form.cancel") + "](" + back + ")"
    }) | indent(4) }}
  </div>
{% endblock %}