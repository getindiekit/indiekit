<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [admin][1]
    -   [Parameters][2]
-   [auth][3]
    -   [indieauth][4]
        -   [Parameters][5]
    -   [scope][6]
        -   [Parameters][7]
-   [cache][8]
    -   [update][9]
        -   [Parameters][10]
    -   [delete][11]
        -   [Parameters][12]
    -   [read][13]
        -   [Parameters][14]
-   [microformats][15]
    -   [derviveContent][16]
        -   [Parameters][17]
    -   [derivePhoto][18]
        -   [Parameters][19]
    -   [derivePostType][20]
        -   [Parameters][21]
    -   [dervivePublished][22]
        -   [Parameters][23]
    -   [derviveSlug][24]
        -   [Parameters][25]
    -   [formEncodedToMf2][26]
        -   [Parameters][27]
    -   [htmlToMf2][28]
        -   [Parameters][29]
    -   [urlToMf2][30]
        -   [Parameters][31]
-   [micropub][32]
    -   [createMedia][33]
        -   [Parameters][34]
    -   [createPost][35]
        -   [Parameters][36]
    -   [deletePost][37]
        -   [Parameters][38]
    -   [query][39]
        -   [Parameters][40]
    -   [saveMedia][41]
        -   [Parameters][42]
    -   [savePost][43]
        -   [Parameters][44]
    -   [undeletePost][45]
        -   [Parameters][46]
    -   [updatePost][47]
        -   [Parameters][48]
-   [publication][49]
    -   [exports][50]
    -   [getCategories][51]
        -   [Parameters][52]
    -   [getPostTypes][53]
        -   [Parameters][54]
    -   [resolveConfig][55]
        -   [Parameters][56]
-   [record][57]
    -   [create][58]
        -   [Parameters][59]
    -   [read][60]
        -   [Parameters][61]
-   [render][62]
    -   [Parameters][63]
-   [store][64]
    -   [github][65]
-   [getContents][66]
    -   [Parameters][67]
-   [createFile][68]
    -   [Parameters][69]
-   [updateFile][70]
    -   [Parameters][71]
-   [deleteFile][72]
    -   [Parameters][73]
-   [utils][74]
    -   [cleanArray][75]
        -   [Parameters][76]
    -   [cleanObject][77]
        -   [Parameters][78]
    -   [createRandomString][79]
        -   [Examples][80]
    -   [deriveFileProperties][81]
        -   [Parameters][82]
        -   [Examples][83]
    -   [deriveMediaType][84]
        -   [Parameters][85]
        -   [Examples][86]
    -   [decodeFormEncodedString][87]
        -   [Parameters][88]
        -   [Examples][89]
    -   [excerptString][90]
        -   [Parameters][91]
        -   [Examples][92]
    -   [isValidUrl][93]
        -   [Parameters][94]
        -   [Examples][95]
    -   [normalizePath][96]
        -   [Parameters][97]
        -   [Examples][98]
    -   [normalizeUrl][99]
        -   [Parameters][100]
        -   [Examples][101]

## admin

Responds to POST requests

### Parameters

-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object

Returns **[Object][102]** Express response object

## auth

Verify access IndieAuth tokens and determine scope.

### indieauth

Verifies that a token provides permissions to post to configured publication,
using [IndieAuth][103] to ensure only
authenticated users can use endpoint for posting to configured destination.

#### Parameters

-   `options` **[Object][102]** Middleware optionn
-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object
-   `next` **[Function][104]** Express callback function

Returns **[Function][104]** Call next middleware function

Returns **[Object][102]** Error response

### scope

Checks if scope in authenticated token contains specified scope.
Automatically handles `post` and `create` as the same thing

#### Parameters

-   `requiredScope` **[String][105]** Scope to check
-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object
-   `next` **[Function][104]** Express callback function

Returns **[Object][102]** Error response

## cache

Caches files to prevent application from making excessive requests to APIs

### update

Creates a new file in the cache, populating it with specified data

#### Parameters

-   `filePath` **[Object][102]** Location to cache file
-   `fileData` **[Object][102]** Data to write to file

### delete

Deletes the cache directory

#### Parameters

-   `dir` **[Object][102]** Location of cache directory

### read

Reads a file in the cache, fetching from store if not found

#### Parameters

-   `storePath` **[String][105]** Path to file in store
-   `cachePath` **[String][105]** Path to file in cache

Returns **([Promise][106] \| [Object][102])** Fetched file object

## microformats

Discover, parse and transform microformats2 objects

### derviveContent

Derives content (HTML, else object value, else property value)

#### Parameters

-   `mf2` **[Object][102]** microformats2 object

Returns **[Array][107]** Content

### derivePhoto

Combines referenced and attached photos into one object which can be used in
a microformats2 object. Attached photos are uploaded to GitHub.

#### Parameters

-   `mf2` **[Object][102]** microformats2 object

Returns **[Promise][106]** Array of photo obejcts

### derivePostType

Combines referenced and attached photos into one object which can be used in
a microformats2 object. Attached photos are uploaded to GitHub.

#### Parameters

-   `mf2` **[Object][102]** microformats2 object

Returns **[String][105]** Post type

### dervivePublished

Derives published date (based on microformats2 data, else the current date)

#### Parameters

-   `mf2` **[Object][102]** microformats2 object

Returns **[Array][107]** Array containing ISO formatted date

### derviveSlug

Derives slug (using `mp-slug` value, slugified name else a random number)

#### Parameters

-   `mf2` **[Object][102]** microformats2 object
-   `separator` **[String][105]** Slug separator

Returns **[Array][107]** Array containing slug value

### formEncodedToMf2

Parses microformats in form-encoded POST request.
Adapted from [node-micropub-express][108]
by [Pelle Wessman][109]

#### Parameters

-   `body` **[String][105]** Form-encoded body

Returns **[Object][102]** mf2 object

**Meta**

-   **copyright**: (c) 2016, Pelle Wessman


### htmlToMf2

Parses microformats on HTML page

#### Parameters

-   `html` **[String][105]** HTML marked up with microformats
-   `properties` **[String][105]** mf2 properties to return

Returns **[Promise][106]** mf2 object

### urlToMf2

Parses microformats at a given URL

#### Parameters

-   `url` **[String][105]** URL path to post
-   `properties` **[String][105]** mf2 properties to return

Returns **[Promise][106]** mf2 object

## micropub

Process and transform microformats in request so that it can be published to
a destination.

### createMedia

Creates a new media file

#### Parameters

-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object
-   `next` **[Function][104]** Express callback function

Returns **[Promise][106]** Express response object

### createPost

Creates a post

#### Parameters

-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object
-   `next` **[Function][104]** Express callback function

Returns **[Promise][106]** Express response object

### deletePost

Deletes a post

#### Parameters

-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object
-   `next` **[Function][104]** Express callback function

Returns **[Promise][106]** Express response object

### query

Returns an object containing information about this application

#### Parameters

-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object

Returns **[Promise][106]** Express response object

### saveMedia

Saves a media file

#### Parameters

-   `pub` **[Object][102]** Publication configuration
-   `file` **[Object][102]** File object

Returns **[String][105]** Location of created file

### savePost

Saves a post file

#### Parameters

-   `pub` **[Object][102]** Publication configuration
-   `mf2` **[Object][102]** Microformats2 object
-   `files` **[String][105]** File attachments

Returns **[String][105]** Location of created file

### undeletePost

Updates a post

#### Parameters

-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object
-   `next` **[Function][104]** Express callback function

Returns **[Object][102]** Express response object

### updatePost

Updates a post

#### Parameters

-   `req` **[Object][102]** Express request object
-   `res` **[Object][102]** Express response object
-   `next` **[Function][104]** Express callback function

Returns **[Object][102]** Express response object

## publication

Get publication configuration

### exports

Default publication configuration

### getCategories

Returns an array of available categories

#### Parameters

-   `pub` **[String][105]** Publication configuration

Returns **([Promise][106] \| [Array][107])** Array of categories

### getPostTypes

Returns an array of supported post types

#### Parameters

-   `pub` **[String][105]** Publication configuration

Returns **[Array][107]** Array of post types

### resolveConfig

Gets a publicationâ€™s configuration and combines it with default values set by
application.

#### Parameters

-   `configPath` **[Object][102]** Path to publication config

Returns **[Promise][106]** Configuration object

## record

Record of an action and associated changes, stored for later retrieval,
i.e. for updating or undelete a post.

### create

Creates a new record

#### Parameters

-   `url` **[Object][102]** URL activity relates to
-   `data` **[Object][102]** Activity data to record

### read

Reads a record

#### Parameters

-   `url` **[Object][102]** URL of post

Returns **[Object][102]** Memo

## render

-   **See: [Nunjucks API: renderString][110]**

Render a Nunjucks template string using context data

### Parameters

-   `string` **[String][105]** Template string
-   `context` **[String][105]** Context data

Returns **[String][105]** Rendered string

## store

Interfaces to remote locations where files and configuration are stored.

### github

Get, create and delete data at a specified path at configured GitHub repo.

## getContents

-   **See: [GitHub REST API v3: Get Contents][111]**

Reads content of a file or directory in a repository

### Parameters

-   `path` **[String][105]** Path to file

Returns **[Promise][106]** GitHub HTTP response

## createFile

-   **See: [GitHub REST API v3: Create a file][112]**

Creates a new file in a GitHub repository

### Parameters

-   `path` **[String][105]** Path to file
-   `content` **[String][105]** File content
-   `options` **[String][105]** Options

Returns **[Promise][106]** GitHub HTTP response

## updateFile

-   **See: [GitHub REST API v3: Update a file][113]**

Updates a file in a GitHub repository

### Parameters

-   `path` **[String][105]** Path to file
-   `content` **[String][105]** File content
-   `options` **[String][105]** Options

Returns **[Promise][106]** GitHub HTTP response

## deleteFile

-   **See: [GitHub REST API v3: Delete a file][114]**

Deletes a file in a GitHub repository

### Parameters

-   `path` **[String][105]** Path to file
-   `options` **[String][105]** Options

Returns **[Promise][106]** GitHub HTTP response

## utils

Common utility functions.

### cleanArray

Remove falsey values if provided object is an array

#### Parameters

-   `obj` **[Object][102]** Object containing array to be cleaned

Returns **([Array][107] \| [Object][102])** Cleaned array, else original object

### cleanObject

Recursively remove empty, null and falsy values from an object
Adapted from [Ori Droriâ€™s answer on Stack Overflow][115]

#### Parameters

-   `obj` **[Object][102]** Object to clean

Returns **[Object][102]** Cleaned object

### createRandomString

Generates random alpha-numeric string, 5 characters long

#### Examples

```javascript
createRandomString() => 'b3dog'
```

Returns **[Object][102]** Alpha-numeric string

### deriveFileProperties

Derives additional file name properties

#### Parameters

-   `file` **[Object][102]** Original file object

#### Examples

```javascript
deriveFileProperties('brighton-pier.jpg') => {
  originalname: 'brighton-pier.jpg',
  filedate: '2019-03-03T05:07:09+00:00',
  filename: 'ds48s',
  fileext: '.jpg'
}
```

Returns **[Object][102]** File properties

### deriveMediaType

Derives media type and returns equivalent IndieWeb post type

#### Parameters

-   `file` **[Object][102]** Original file object

#### Examples

```javascript
deriveMediaType('brighton-pier.jpg') => 'photo'
```

Returns **[String][105]** Returns either 'photo', 'video' or audio

### decodeFormEncodedString

Decodes form-encoded string

#### Parameters

-   `str` **[String][105]** String to decode

#### Examples

```javascript
decodeFormEncodedString('foo+bar') => 'foo bar'
```

```javascript
decodeFormEncodedString('http%3A%2F%2Ffoo.bar') => 'http://foo.bar'
```

Returns **[String][105]** Decoded string

### excerptString

Gets first n words from a string

#### Parameters

-   `str` **[String][105]** String to excerpt
-   `n` **[Number][116]** Max number of words

#### Examples

```javascript
excerptString('Foo bar baz', 2) => 'Foo bar'
```

Returns **[String][105]** Excerpt

### isValidUrl

Checks if string is valid URL

#### Parameters

-   `str` **[Object][102]** String

#### Examples

```javascript
isValidUrl('https://example.com') => true
```

Returns **[Boolean][117]** True or false

### normalizePath

Removes â€˜/â€™ from beginning and end of string. Useful for constructing paths

#### Parameters

-   `str` **[String][105]** Path to normalize

#### Examples

```javascript
normalizePath('/foo/bar/') => 'foo/bar'
```

Returns **[String][105]** Normalized path

### normalizeUrl

Removes protocol from beginning of URL

#### Parameters

-   `str` **[String][105]** URL to normalize

#### Examples

```javascript
normalizeUrl('http://foo.bar/baz') => 'foo.bar/baz'
```

```javascript
normalizeUrl('https://foo.bar/baz') => 'foo.bar/baz'
```

Returns **[String][105]** Normalized URL

[1]: #admin

[2]: #parameters

[3]: #auth

[4]: #indieauth

[5]: #parameters-1

[6]: #scope

[7]: #parameters-2

[8]: #cache

[9]: #update

[10]: #parameters-3

[11]: #delete

[12]: #parameters-4

[13]: #read

[14]: #parameters-5

[15]: #microformats

[16]: #dervivecontent

[17]: #parameters-6

[18]: #derivephoto

[19]: #parameters-7

[20]: #deriveposttype

[21]: #parameters-8

[22]: #dervivepublished

[23]: #parameters-9

[24]: #derviveslug

[25]: #parameters-10

[26]: #formencodedtomf2

[27]: #parameters-11

[28]: #htmltomf2

[29]: #parameters-12

[30]: #urltomf2

[31]: #parameters-13

[32]: #micropub

[33]: #createmedia

[34]: #parameters-14

[35]: #createpost

[36]: #parameters-15

[37]: #deletepost

[38]: #parameters-16

[39]: #query

[40]: #parameters-17

[41]: #savemedia

[42]: #parameters-18

[43]: #savepost

[44]: #parameters-19

[45]: #undeletepost

[46]: #parameters-20

[47]: #updatepost

[48]: #parameters-21

[49]: #publication

[50]: #exports

[51]: #getcategories

[52]: #parameters-22

[53]: #getposttypes

[54]: #parameters-23

[55]: #resolveconfig

[56]: #parameters-24

[57]: #record

[58]: #create

[59]: #parameters-25

[60]: #read-1

[61]: #parameters-26

[62]: #render

[63]: #parameters-27

[64]: #store

[65]: #github

[66]: #getcontents

[67]: #parameters-28

[68]: #createfile

[69]: #parameters-29

[70]: #updatefile

[71]: #parameters-30

[72]: #deletefile

[73]: #parameters-31

[74]: #utils

[75]: #cleanarray

[76]: #parameters-32

[77]: #cleanobject

[78]: #parameters-33

[79]: #createrandomstring

[80]: #examples

[81]: #derivefileproperties

[82]: #parameters-34

[83]: #examples-1

[84]: #derivemediatype

[85]: #parameters-35

[86]: #examples-2

[87]: #decodeformencodedstring

[88]: #parameters-36

[89]: #examples-3

[90]: #excerptstring

[91]: #parameters-37

[92]: #examples-4

[93]: #isvalidurl

[94]: #parameters-38

[95]: #examples-5

[96]: #normalizepath

[97]: #parameters-39

[98]: #examples-6

[99]: #normalizeurl

[100]: #parameters-40

[101]: #examples-7

[102]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[103]: https://www.w3.org/TR/indieauth/

[104]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[105]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[106]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[107]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[108]: https://github.com/voxpelli/node-micropub-express

[109]: https://kodfabrik.se

[110]: https://mozilla.github.io/nunjucks/api.html#renderstring

[111]: https://developer.github.com/v3/repos/contents/#get-contents

[112]: https://developer.github.com/v3/repos/contents/#create-a-file

[113]: https://developer.github.com/v3/repos/contents/#update-a-file

[114]: https://developer.github.com/v3/repos/contents/#delete-a-file

[115]: https://stackoverflow.com/a/54186837

[116]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[117]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean
